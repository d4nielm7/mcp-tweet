# Railway Deployment Guide

This guide will help you deploy the Beautiful Gradient MCP Server to Railway.

## Prerequisites

1. **Railway Account**: Sign up at [railway.app](https://railway.app)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **Stytch Account**: You need Stytch credentials for OAuth

## Step 1: Connect to Railway

1. Go to [railway.app](https://railway.app) and sign in
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository containing this project

## Step 2: Configure Project Settings

Railway will automatically detect this as a Python project based on `requirements.txt`.

### Root Directory Configuration
Set the **Root Directory** to: `beautiful_gradient_mcp`

This tells Railway to look in the `beautiful_gradient_mcp` folder for your Python application.

## Step 3: Add PostgreSQL Database

1. In your Railway project, click "New"
2. Select "Database" ‚Üí "Add PostgreSQL"
3. Railway will automatically create a PostgreSQL database

## Step 4: Set Environment Variables

### üö® Important: No `.env` File Needed in Railway

**Local Development vs. Railway Deployment:**

- **Local Development**: Uses `.env` file in your project directory
- **Railway Deployment**: Uses environment variables set in Railway's dashboard (no `.env` file needed)

**Your code already handles this correctly** - it uses `os.getenv()` to read environment variables, which works both locally (from `.env` file) and on Railway (from dashboard settings).

Railway doesn't use `.env` files. Instead, you set environment variables directly in Railway's dashboard.

### How to Add Environment Variables in Railway:

1. Go to your Railway project dashboard
2. Click on your service (the main app, not the database)
3. Click the "Variables" tab
4. Click "New Variable" for each environment variable below
5. Enter the variable name and value, then click "Add"

### Required Variables

Add these environment variables one by one in Railway's dashboard:

| Variable Name | Value/Example | Description |
|---------------|---------------|-------------|
| `STYTCH_PROJECT_ID` | `project-test-1635b418-0599-4f50-b59b-de4f5489cb13` | Your Stytch project ID |
| `STYTCH_PUBLIC_TOKEN` | `public-token-test-ccb9309a-61fb-480e-99e9-f6d07ef1e545` | Your Stytch public token |
| `STYTCH_CLIENT_ID` | `connected-app-test-fd392e29-366c-489c-a0e8-e4123d635779` | Your Stytch client ID |
| `DATABASE_URL` | *(Auto-generated by Railway)* | PostgreSQL connection string (set automatically when you add PostgreSQL) |
| `USE_HTTPS` | `false` | Set to false for Railway (Railway handles HTTPS automatically) |
| `RELOAD` | `false` | Set to false for production deployment |
| `MCP_SERVER_URL` | `https://your-app-name.up.railway.app` | Your Railway app URL (update after deployment) |

### Optional Variables

| Variable Name | Value/Example | Description |
|---------------|---------------|-------------|
| `STYTCH_SECRET` | Your Stytch secret | For server-side authentication |
| `STYTCH_AUTHORIZATION_SERVER` | `https://your-stytch-domain.customers.stytch.dev` | Custom Stytch domain |
| `CLOUDINARY_URL` | `cloudinary://api_key:api_secret@cloud_name` | For image sharing functionality |

### Database Variables (Automatically Set)

Railway automatically provides these when you add PostgreSQL:
- `DATABASE_URL` - Complete PostgreSQL connection string
- `PGHOST`, `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE` - Individual database components

### üí° Pro Tip: Setting MCP_SERVER_URL

After your first deployment, Railway will give you a URL like `https://your-app-name.up.railway.app`. You need to:

1. Copy that URL
2. Go to your service's Variables tab
3. Add/update `MCP_SERVER_URL` with your Railway URL
4. This will trigger a redeploy with the correct URL

## Step 5: Deploy

1. Railway will automatically detect your repository and start deploying
2. The deployment process will:
   - Install Python dependencies from `requirements.txt`
   - Start your FastAPI server using `main.py`
   - Initialize the PostgreSQL database tables

## Step 6: Verify Deployment

Once deployed, Railway will provide you with a URL like: `https://your-app-name.up.railway.app`

Test these endpoints:

1. **Health Check**: `https://your-app-name.up.railway.app/.well-known/oauth-protected-resource`
2. **MCP Endpoint**: `https://your-app-name.up.railway.app/mcp`
3. **Frontend**: `https://your-app-name.up.railway.app/login`

## Step 7: Configure Your Application

Update your `MCP_SERVER_URL` environment variable to match your Railway URL:

```bash
MCP_SERVER_URL=https://your-app-name.up.railway.app
```

## Troubleshooting

### Database Connection Issues
- Ensure `DATABASE_URL` is properly set by Railway's PostgreSQL addon
- Check the Railway logs for database connection errors

### OAuth Issues
- Verify all Stytch environment variables are correct
- Make sure your Stytch project is configured for your Railway domain

### Port Issues
- Railway automatically sets the `PORT` environment variable
- The app is configured to use Railway's `PORT` variable

### Logs
Check Railway's deployment logs to diagnose any issues:
1. Go to your Railway project
2. Click on your service
3. View the "Deployments" tab for logs

## Environment Variables Reference

| Variable | Required | Description |
|----------|----------|-------------|
| `STYTCH_PROJECT_ID` | ‚úÖ | Stytch project ID for OAuth |
| `STYTCH_PUBLIC_TOKEN` | ‚úÖ | Stytch public token |
| `STYTCH_CLIENT_ID` | ‚úÖ | Stytch client ID |
| `DATABASE_URL` | ‚úÖ | PostgreSQL connection string (auto-set) |
| `MCP_SERVER_URL` | ‚úÖ | Your Railway app URL |
| `PORT` | Auto | Railway sets this automatically |
| `USE_HTTPS` | ‚ùå | Set to `false` for Railway |
| `RELOAD` | ‚ùå | Set to `false` for production |

## Next Steps

After deployment:
1. Test the OAuth flow with your Stytch configuration
2. Verify the MCP tools work correctly
3. Update any documentation with your new Railway URL
4. Configure your ChatGPT connectors to use the Railway URL
